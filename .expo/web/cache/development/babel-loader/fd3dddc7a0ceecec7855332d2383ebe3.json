{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport { useEffect, useState } from 'react';\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport { getCurrentPositionAsync, useForegroundPermissions, PermissionStatus } from 'expo-location';\nimport { useNavigation, useRoute, useIsFocused } from '@react-navigation/native';\nimport { getAddress, getMapPreview } from \"../map/location\";\nimport OutlinedButton from \"../Buttons/OutlinedButton\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nfunction LocationPicker(_ref) {\n  var onPickLocation = _ref.onPickLocation;\n  var navigation = useNavigation();\n  var route = useRoute();\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      pickedLocation = _useState2[0],\n      setPickedLocation = _useState2[1];\n\n  var isFocused = useIsFocused();\n\n  var _useForegroundPermiss = useForegroundPermissions(),\n      _useForegroundPermiss2 = _slicedToArray(_useForegroundPermiss, 2),\n      locationPermissionInformation = _useForegroundPermiss2[0],\n      requestPermission = _useForegroundPermiss2[1];\n\n  useEffect(function () {\n    if (isFocused && route.params) {\n      var mapPickedLocation = {\n        lat: route.params.pickedLat,\n        lng: route.params.pickedLng\n      };\n      setPickedLocation(mapPickedLocation);\n    }\n  }, [route, isFocused]);\n  useEffect(function () {\n    function handleLocation() {\n      var address;\n      return _regeneratorRuntime.async(function handleLocation$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!pickedLocation) {\n                _context.next = 5;\n                break;\n              }\n\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(getAddress(pickedLocation.lat, pickedLocation.lng));\n\n            case 3:\n              address = _context.sent;\n              onPickLocation(_objectSpread(_objectSpread({}, pickedLocation), {}, {\n                address: address\n              }));\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n\n    handleLocation();\n  }, [pickedLocation, onPickLocation]);\n\n  function verifyPermissions() {\n    var permissionResponse;\n    return _regeneratorRuntime.async(function verifyPermissions$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(locationPermissionInformation.status === PermissionStatus.UNDETERMINED || locationPermissionInformation.status === PermissionStatus.DENIED)) {\n              _context2.next = 5;\n              break;\n            }\n\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(requestPermission());\n\n          case 3:\n            permissionResponse = _context2.sent;\n            return _context2.abrupt(\"return\", permissionResponse.granted);\n\n          case 5:\n            return _context2.abrupt(\"return\", true);\n\n          case 6:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function getLocationHandler() {\n    var hasPermission, location;\n    return _regeneratorRuntime.async(function getLocationHandler$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _regeneratorRuntime.awrap(verifyPermissions());\n\n          case 2:\n            hasPermission = _context3.sent;\n\n            if (hasPermission) {\n              _context3.next = 5;\n              break;\n            }\n\n            return _context3.abrupt(\"return\");\n\n          case 5:\n            _context3.next = 7;\n            return _regeneratorRuntime.awrap(getCurrentPositionAsync());\n\n          case 7:\n            location = _context3.sent;\n            setPickedLocation({\n              lat: location.coords.latitude,\n              lng: location.coords.longitude\n            });\n\n          case 9:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function pickOnMapHandler() {\n    navigation.navigate('PickLocation');\n  }\n\n  var locationPreview = _jsx(Text, {\n    children: \" No Location Picked Yet \"\n  });\n\n  if (pickedLocation) {\n    locationPreview = _jsx(Image, {\n      style: styles.image,\n      source: {\n        uri: getMapPreview(pickedLocation.lat, pickedLocation.lng)\n      }\n    });\n  }\n\n  return _jsxs(View, {\n    children: [_jsx(View, {\n      style: styles.mapPreview,\n      children: locationPreview\n    }), _jsxs(View, {\n      style: styles.actions,\n      children: [_jsx(OutlinedButton, {\n        icon: \"location\",\n        onPress: getLocationHandler,\n        children: \" Your Location \"\n      }), _jsx(OutlinedButton, {\n        icon: \"map\",\n        onPress: pickOnMapHandler,\n        children: \" Pick Location\"\n      })]\n    })]\n  });\n}\n\nexport default LocationPicker;\nvar styles = StyleSheet.create({\n  mapPreview: {\n    width: '100%',\n    height: 200,\n    justifyContent: 'center',\n    alignItems: 'center',\n    backgroundColor: 'lightblue',\n    borderRadius: 5\n  },\n  actions: {\n    flexDirection: 'row',\n    justifyContent: 'space-around',\n    alignItems: 'center',\n    paddingTop: 10,\n    paddingBottom: 10\n  },\n  image: {\n    width: '100%',\n    height: '100%'\n  }\n});","map":{"version":3,"names":["useEffect","useState","getCurrentPositionAsync","useForegroundPermissions","PermissionStatus","useNavigation","useRoute","useIsFocused","getAddress","getMapPreview","OutlinedButton","LocationPicker","onPickLocation","navigation","route","pickedLocation","setPickedLocation","isFocused","locationPermissionInformation","requestPermission","params","mapPickedLocation","lat","pickedLat","lng","pickedLng","handleLocation","address","verifyPermissions","status","UNDETERMINED","DENIED","permissionResponse","granted","getLocationHandler","hasPermission","location","coords","latitude","longitude","pickOnMapHandler","navigate","locationPreview","styles","image","uri","mapPreview","actions","StyleSheet","create","width","height","justifyContent","alignItems","backgroundColor","borderRadius","flexDirection","paddingTop","paddingBottom"],"sources":["/Users/hanyang/Orbital2022/components/hostActivity/LocationPicker.js"],"sourcesContent":["import { useEffect, useState} from 'react';\nimport { Image, Text, Alert, View, StyleSheet} from 'react-native';\nimport { getCurrentPositionAsync, useForegroundPermissions, PermissionStatus } from 'expo-location';\nimport { useNavigation, useRoute, useIsFocused } from '@react-navigation/native';\nimport { getAddress, getMapPreview } from '../map/location';\n\nimport OutlinedButton from '../Buttons/OutlinedButton';\n\nfunction LocationPicker({onPickLocation}) {\n    const navigation = useNavigation();\n    const route = useRoute();\n\n    const [pickedLocation, setPickedLocation] = useState();\n    const isFocused = useIsFocused(); //false when you enter PickLocationScreen, true when this component is in a screen which has it(when come back from PickLocationScreen)\n\n    const [locationPermissionInformation, requestPermission] = useForegroundPermissions();\n\n\n\n    useEffect(() => {\n        if (isFocused && route.params) {\n            const mapPickedLocation = {\n                lat: route.params.pickedLat, \n                lng: route.params.pickedLng\n            };\n            setPickedLocation(mapPickedLocation);\n        }\n    }, [route, isFocused]);\n\n    useEffect(() => {\n        async function handleLocation() {\n            if (pickedLocation) {\n                const address = await getAddress(\n                    pickedLocation.lat,\n                    pickedLocation.lng\n                );\n                onPickLocation({...pickedLocation, address:address });\n            }\n        }\n        handleLocation();\n    }, [pickedLocation, onPickLocation]);\n\n\n    async function verifyPermissions() {\n        if (locationPermissionInformation.status === PermissionStatus.UNDETERMINED || locationPermissionInformation.status === PermissionStatus.DENIED ){\n            const permissionResponse = await requestPermission();\n            return permissionResponse.granted;\n        }\n\n//        if (locationPermissionInformation.status === PermissionStatus.DENIED) {\n//            Alert.alert(\n//                'Insufficient Permission!',\n//                'You need to grant location service permissions to use this.'\n\n //           );\n//            return false;\n\n//        }\n        return true;\n    }\n\n    async function getLocationHandler() {\n        const hasPermission = await verifyPermissions();\n        if (!hasPermission) {\n            return;\n        }\n        const location = await getCurrentPositionAsync();\n        setPickedLocation({\n            lat: location.coords.latitude,\n            lng: location.coords.longitude\n        });\n    }\n\n    function pickOnMapHandler() {\n        navigation.navigate('PickLocation');\n    }\n\n    let locationPreview = <Text> No Location Picked Yet </Text>; \n    if (pickedLocation) {\n       locationPreview = ( \n            <Image\n                style = {styles.image} \n                  source = {{\n                    uri: getMapPreview(pickedLocation.lat, pickedLocation.lng),\n                 }} \n            />\n    \n        );\n    }\n\n    return( \n        <View>\n            <View style = {styles.mapPreview}>\n                {locationPreview}\n            </View>\n            <View style = {styles.actions}>\n                <OutlinedButton icon = \"location\" onPress={getLocationHandler}> Your Location </OutlinedButton>\n                <OutlinedButton icon = \"map\" onPress = {pickOnMapHandler}> Pick Location</OutlinedButton>\n            </View> \n            \n        </View>\n    );\n\n}\n\nexport default LocationPicker;\n\nconst styles = StyleSheet.create({\n    mapPreview: {\n        width: '100%',\n        height:200,\n        justifyContent: 'center',\n        alignItems: 'center',\n        backgroundColor: 'lightblue',\n        borderRadius: 5,\n    },\n    actions: {\n        flexDirection:'row',\n        justifyContent: 'space-around',\n        alignItems:'center',\n        paddingTop:10,\n        paddingBottom:10\n    },\n    image: {\n        width: '100%',\n        height: '100%'\n    }\n\n});"],"mappings":"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"},"metadata":{},"sourceType":"module"}