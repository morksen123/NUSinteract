{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState, useContext, useEffect } from 'react';\nimport Button from \"react-native-web/dist/exports/Button\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport { supabase } from \"../utils/supabase\";\nimport * as ImagePicker from 'expo-image-picker';\nimport { UserContext } from \"../contexts/userContext\";\nimport 'react-native-url-polyfill/auto';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function DummyScreen() {\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      image = _useState2[0],\n      setImage = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      avatarUrl = _useState4[0],\n      setAvatarUrl = _useState4[1];\n\n  var _useContext = useContext(UserContext),\n      user = _useContext.user;\n\n  var pickImage = function _callee() {\n    var result, ext, fileName, formData, _await$supabase$stora, _data, _error, _await$supabase$from$, data, error;\n\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({\n              mediaTypes: ImagePicker.MediaTypeOptions.All,\n              allowsEditing: true,\n              aspect: [4, 3],\n              quality: 1\n            }));\n\n          case 2:\n            result = _context.sent;\n\n            if (result.cancelled) {\n              _context.next = 15;\n              break;\n            }\n\n            setImage(result.uri);\n            ext = result.uri.substring(result.uri.lastIndexOf(\".\") + 1);\n            fileName = result.uri.replace(/^.*[\\\\\\/]/, \"\");\n            formData = new FormData();\n            formData.append(\"files\", {\n              uri: result.uri,\n              name: fileName,\n              type: result.type ? \"image/\" + ext : \"video/\" + ext\n            });\n            _context.next = 11;\n            return _regeneratorRuntime.awrap(supabase.storage.from(\"avatars\").upload(fileName, formData));\n\n          case 11:\n            _await$supabase$stora = _context.sent;\n            _data = _await$supabase$stora.data;\n            _error = _await$supabase$stora.error;\n\n            if (_error) {\n              Alert.alert(_error.message);\n            } else {\n              setAvatarUrl(_data.Key);\n            }\n\n          case 15:\n            _context.next = 17;\n            return _regeneratorRuntime.awrap(supabase.from('users').upsert({\n              id: user.id,\n              avatar_url: avatarUrl\n            }));\n\n          case 17:\n            _await$supabase$from$ = _context.sent;\n            data = _await$supabase$from$.data;\n            error = _await$supabase$from$.error;\n\n          case 20:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  console.log(avatarUrl);\n  return _jsxs(View, {\n    style: {\n      flex: 1,\n      alignItems: 'center',\n      justifyContent: 'center'\n    },\n    children: [_jsx(Button, {\n      title: \"Pick an image from camera roll\",\n      onPress: pickImage\n    }), Image && _jsx(Image, {\n      source: {\n        uri: \"https://aqeopdkkfhradtlezpil.supabase.co/storage/v1/object/public/\" + avatarUrl\n      },\n      style: {\n        width: 200,\n        height: 200\n      }\n    })]\n  });\n}","map":{"version":3,"names":["React","useState","useContext","useEffect","supabase","ImagePicker","UserContext","DummyScreen","image","setImage","avatarUrl","setAvatarUrl","user","pickImage","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","All","allowsEditing","aspect","quality","result","cancelled","uri","ext","substring","lastIndexOf","fileName","replace","formData","FormData","append","name","type","storage","from","upload","data","error","Alert","alert","message","Key","upsert","id","avatar_url","console","log","flex","alignItems","justifyContent","Image","width","height"],"sources":["/Users/hanyang/Orbital2022/screens/DummyScreen.js"],"sourcesContent":["import React, { useState, useContext, useEffect } from 'react';\n\nimport { Button, Image, View, Alert, Text } from 'react-native';\n\nimport { supabase } from '../utils/supabase';\n\nimport * as ImagePicker from 'expo-image-picker';\nimport { UserContext } from '../contexts/userContext';\n\n/* polyfills */\n/** URL polyfill */\nimport 'react-native-url-polyfill/auto';\n\nexport default function DummyScreen() {\n  const [image, setImage] = useState(null);\n  const [avatarUrl, setAvatarUrl] = useState(\"\"); \n\n  const { user } = useContext(UserContext);\n\n  const pickImage = async () => {\n    // No permissions request is necessary for launching the image library\n    let result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: ImagePicker.MediaTypeOptions.All,\n      allowsEditing: true,\n      aspect: [4, 3],\n      quality: 1,\n    });\n\n\n    if (!result.cancelled) {\n      setImage(result.uri);\n\n      const ext = result.uri.substring(result.uri.lastIndexOf(\".\") + 1);\n\n      const fileName = result.uri.replace(/^.*[\\\\\\/]/, \"\");\n\n      var formData = new FormData();\n      formData.append(\"files\", {\n          uri: result.uri,\n          name: fileName, \n          type: result.type ? `image/${ext}` : `video/${ext}`,\n      })\n\n      const { data, error } = await supabase.storage\n        .from(\"avatars\")\n        .upload(fileName, formData)\n\n      if (error) {\n          Alert.alert(error.message);\n      } else {\n          setAvatarUrl(data.Key); \n      }\n    }\n    \n\n    const { data, error } = await supabase.from('users').upsert({\n            id: user.id, \n            avatar_url: avatarUrl\n        })\n\n  };\n\n  console.log(avatarUrl)\n\n  return (\n    <View style={{ flex: 1, alignItems: 'center', justifyContent: 'center' }}>\n      <Button title=\"Pick an image from camera roll\" onPress={pickImage} />\n        {Image && <Image source={{ uri: `https://aqeopdkkfhradtlezpil.supabase.co/storage/v1/object/public/${avatarUrl}`}} style={{width: 200, height: 200}} />}\n\n    </View>\n  );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}