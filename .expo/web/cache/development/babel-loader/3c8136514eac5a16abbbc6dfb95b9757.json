{"ast":null,"code":"import _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _excluded = [\"messages\", \"user\", \"inverted\"];\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport { LoadEarlier } from \"./LoadEarlier\";\nimport Message from \"./Message\";\nimport Color from \"./Color\";\nimport TypingIndicator from \"./TypingIndicator\";\nimport { StylePropType } from \"./utils\";\nimport { warning } from \"./logging\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1\n  },\n  containerAlignTop: {\n    flexDirection: 'row',\n    alignItems: 'flex-start'\n  },\n  contentContainerStyle: {\n    flexGrow: 1,\n    justifyContent: 'flex-start'\n  },\n  emptyChatContainer: {\n    flex: 1,\n    transform: [{\n      scaleY: -1\n    }]\n  },\n  headerWrapper: {\n    flex: 1\n  },\n  listStyle: {\n    flex: 1\n  },\n  scrollToBottomStyle: {\n    opacity: 0.8,\n    position: 'absolute',\n    right: 10,\n    bottom: 30,\n    zIndex: 999,\n    height: 40,\n    width: 40,\n    borderRadius: 20,\n    backgroundColor: Color.white,\n    alignItems: 'center',\n    justifyContent: 'center',\n    shadowColor: Color.black,\n    shadowOpacity: 0.5,\n    shadowOffset: {\n      width: 0,\n      height: 0\n    },\n    shadowRadius: 1\n  }\n});\n\nvar MessageContainer = function (_React$PureComponent) {\n  _inherits(MessageContainer, _React$PureComponent);\n\n  var _super = _createSuper(MessageContainer);\n\n  function MessageContainer() {\n    var _this;\n\n    _classCallCheck(this, MessageContainer);\n\n    _this = _super.apply(this, arguments);\n    _this.state = {\n      showScrollBottom: false,\n      hasScrolled: false\n    };\n\n    _this.renderTypingIndicator = function () {\n      if (Platform.OS === 'web') {\n        return null;\n      }\n\n      return _jsx(TypingIndicator, {\n        isTyping: _this.props.isTyping || false\n      });\n    };\n\n    _this.renderFooter = function () {\n      if (_this.props.renderFooter) {\n        return _this.props.renderFooter(_this.props);\n      }\n\n      return _this.renderTypingIndicator();\n    };\n\n    _this.renderLoadEarlier = function () {\n      if (_this.props.loadEarlier === true) {\n        var loadEarlierProps = _objectSpread({}, _this.props);\n\n        if (_this.props.renderLoadEarlier) {\n          return _this.props.renderLoadEarlier(loadEarlierProps);\n        }\n\n        return _jsx(LoadEarlier, _objectSpread({}, loadEarlierProps));\n      }\n\n      return null;\n    };\n\n    _this.scrollToBottom = function () {\n      var animated = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var inverted = _this.props.inverted;\n\n      if (inverted) {\n        _this.scrollTo({\n          offset: 0,\n          animated: animated\n        });\n      } else if (_this.props.forwardRef && _this.props.forwardRef.current) {\n        _this.props.forwardRef.current.scrollToEnd({\n          animated: animated\n        });\n      }\n    };\n\n    _this.handleOnScroll = function (event) {\n      var _event$nativeEvent = event.nativeEvent,\n          contentOffsetY = _event$nativeEvent.contentOffset.y,\n          contentSizeHeight = _event$nativeEvent.contentSize.height,\n          layoutMeasurementHeight = _event$nativeEvent.layoutMeasurement.height;\n      var scrollToBottomOffset = _this.props.scrollToBottomOffset;\n\n      if (_this.props.inverted) {\n        if (contentOffsetY > scrollToBottomOffset) {\n          _this.setState({\n            showScrollBottom: true,\n            hasScrolled: true\n          });\n        } else {\n          _this.setState({\n            showScrollBottom: false,\n            hasScrolled: true\n          });\n        }\n      } else {\n        if (contentOffsetY < scrollToBottomOffset && contentSizeHeight - layoutMeasurementHeight > scrollToBottomOffset) {\n          _this.setState({\n            showScrollBottom: true,\n            hasScrolled: true\n          });\n        } else {\n          _this.setState({\n            showScrollBottom: false,\n            hasScrolled: true\n          });\n        }\n      }\n    };\n\n    _this.renderRow = function (_ref) {\n      var item = _ref.item,\n          index = _ref.index;\n\n      if (!item._id && item._id !== 0) {\n        warning('GiftedChat: `_id` is missing for message', JSON.stringify(item));\n      }\n\n      if (!item.user) {\n        if (!item.system) {\n          warning('GiftedChat: `user` is missing for message', JSON.stringify(item));\n        }\n\n        item.user = {\n          _id: 0\n        };\n      }\n\n      var _this$props = _this.props,\n          messages = _this$props.messages,\n          user = _this$props.user,\n          inverted = _this$props.inverted,\n          restProps = _objectWithoutProperties(_this$props, _excluded);\n\n      if (messages && user) {\n        var previousMessage = (inverted ? messages[index + 1] : messages[index - 1]) || {};\n        var nextMessage = (inverted ? messages[index - 1] : messages[index + 1]) || {};\n\n        var messageProps = _objectSpread(_objectSpread({}, restProps), {}, {\n          user: user,\n          key: item._id,\n          currentMessage: item,\n          previousMessage: previousMessage,\n          inverted: inverted,\n          nextMessage: nextMessage,\n          position: item.user._id === user._id ? 'right' : 'left'\n        });\n\n        if (_this.props.renderMessage) {\n          return _this.props.renderMessage(messageProps);\n        }\n\n        return _jsx(Message, _objectSpread({}, messageProps));\n      }\n\n      return null;\n    };\n\n    _this.renderChatEmpty = function () {\n      if (_this.props.renderChatEmpty) {\n        return _this.props.inverted ? _this.props.renderChatEmpty() : _jsx(View, {\n          style: styles.emptyChatContainer,\n          children: _this.props.renderChatEmpty()\n        });\n      }\n\n      return _jsx(View, {\n        style: styles.container\n      });\n    };\n\n    _this.renderHeaderWrapper = function () {\n      return _jsx(View, {\n        style: styles.headerWrapper,\n        children: _this.renderLoadEarlier()\n      });\n    };\n\n    _this.onLayoutList = function () {\n      if (!_this.props.inverted && !!_this.props.messages && _this.props.messages.length) {\n        setTimeout(function () {\n          return _this.scrollToBottom && _this.scrollToBottom(false);\n        }, 15 * _this.props.messages.length);\n      }\n    };\n\n    _this.onEndReached = function (_ref2) {\n      var distanceFromEnd = _ref2.distanceFromEnd;\n      var _this$props2 = _this.props,\n          loadEarlier = _this$props2.loadEarlier,\n          onLoadEarlier = _this$props2.onLoadEarlier,\n          infiniteScroll = _this$props2.infiniteScroll,\n          isLoadingEarlier = _this$props2.isLoadingEarlier;\n\n      if (infiniteScroll && (_this.state.hasScrolled || distanceFromEnd > 0) && distanceFromEnd <= 100 && loadEarlier && onLoadEarlier && !isLoadingEarlier && Platform.OS !== 'web') {\n        onLoadEarlier();\n      }\n    };\n\n    _this.keyExtractor = function (item) {\n      return \"\" + item._id;\n    };\n\n    return _this;\n  }\n\n  _createClass(MessageContainer, [{\n    key: \"scrollTo\",\n    value: function scrollTo(options) {\n      if (this.props.forwardRef && this.props.forwardRef.current && options) {\n        this.props.forwardRef.current.scrollToOffset(options);\n      }\n    }\n  }, {\n    key: \"renderScrollBottomComponent\",\n    value: function renderScrollBottomComponent() {\n      var scrollToBottomComponent = this.props.scrollToBottomComponent;\n\n      if (scrollToBottomComponent) {\n        return scrollToBottomComponent();\n      }\n\n      return _jsx(Text, {\n        children: \"V\"\n      });\n    }\n  }, {\n    key: \"renderScrollToBottomWrapper\",\n    value: function renderScrollToBottomWrapper() {\n      var _this2 = this;\n\n      var propsStyle = this.props.scrollToBottomStyle || {};\n      return _jsx(View, {\n        style: [styles.scrollToBottomStyle, propsStyle],\n        children: _jsx(TouchableOpacity, {\n          onPress: function onPress() {\n            return _this2.scrollToBottom();\n          },\n          hitSlop: {\n            top: 5,\n            left: 5,\n            right: 5,\n            bottom: 5\n          },\n          children: this.renderScrollBottomComponent()\n        })\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var inverted = this.props.inverted;\n      return _jsxs(View, {\n        style: this.props.alignTop ? styles.containerAlignTop : styles.container,\n        children: [this.state.showScrollBottom && this.props.scrollToBottom ? this.renderScrollToBottomWrapper() : null, _jsx(FlatList, _objectSpread(_objectSpread({\n          ref: this.props.forwardRef,\n          extraData: [this.props.extraData, this.props.isTyping],\n          keyExtractor: this.keyExtractor,\n          enableEmptySections: true,\n          automaticallyAdjustContentInsets: false,\n          inverted: inverted,\n          data: this.props.messages,\n          style: styles.listStyle,\n          contentContainerStyle: styles.contentContainerStyle,\n          renderItem: this.renderRow\n        }, this.props.invertibleScrollViewProps), {}, {\n          ListEmptyComponent: this.renderChatEmpty,\n          ListFooterComponent: inverted ? this.renderHeaderWrapper : this.renderFooter,\n          ListHeaderComponent: inverted ? this.renderFooter : this.renderHeaderWrapper,\n          onScroll: this.handleOnScroll,\n          scrollEventThrottle: 100,\n          onLayout: this.onLayoutList,\n          onEndReached: this.onEndReached,\n          onEndReachedThreshold: 0.1\n        }, this.props.listViewProps))]\n      });\n    }\n  }]);\n\n  return MessageContainer;\n}(React.PureComponent);\n\nexport { MessageContainer as default };\nMessageContainer.defaultProps = {\n  messages: [],\n  user: {},\n  isTyping: false,\n  renderChatEmpty: null,\n  renderFooter: null,\n  renderMessage: null,\n  onLoadEarlier: function onLoadEarlier() {},\n  onQuickReply: function onQuickReply() {},\n  inverted: true,\n  loadEarlier: false,\n  listViewProps: {},\n  invertibleScrollViewProps: {},\n  extraData: null,\n  scrollToBottom: false,\n  scrollToBottomOffset: 200,\n  alignTop: false,\n  scrollToBottomStyle: {},\n  infiniteScroll: false,\n  isLoadingEarlier: false\n};\nMessageContainer.propTypes = {\n  messages: PropTypes.arrayOf(PropTypes.object),\n  isTyping: PropTypes.bool,\n  user: PropTypes.object,\n  renderChatEmpty: PropTypes.func,\n  renderFooter: PropTypes.func,\n  renderMessage: PropTypes.func,\n  renderLoadEarlier: PropTypes.func,\n  onLoadEarlier: PropTypes.func,\n  listViewProps: PropTypes.object,\n  inverted: PropTypes.bool,\n  loadEarlier: PropTypes.bool,\n  invertibleScrollViewProps: PropTypes.object,\n  extraData: PropTypes.object,\n  scrollToBottom: PropTypes.bool,\n  scrollToBottomOffset: PropTypes.number,\n  scrollToBottomComponent: PropTypes.func,\n  alignTop: PropTypes.bool,\n  scrollToBottomStyle: StylePropType,\n  infiniteScroll: PropTypes.bool\n};","map":{"version":3,"sources":["../src/MessageContainer.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import PropTypes from 'prop-types';\nimport React from 'react';\nimport { FlatList, View, StyleSheet, TouchableOpacity, Text, Platform, } from 'react-native';\nimport { LoadEarlier } from './LoadEarlier';\nimport Message from './Message';\nimport Color from './Color';\nimport TypingIndicator from './TypingIndicator';\nimport { StylePropType } from './utils';\nimport { warning } from './logging';\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n    },\n    containerAlignTop: {\n        flexDirection: 'row',\n        alignItems: 'flex-start',\n    },\n    contentContainerStyle: {\n        flexGrow: 1,\n        justifyContent: 'flex-start',\n    },\n    emptyChatContainer: {\n        flex: 1,\n        transform: [{ scaleY: -1 }],\n    },\n    headerWrapper: {\n        flex: 1,\n    },\n    listStyle: {\n        flex: 1,\n    },\n    scrollToBottomStyle: {\n        opacity: 0.8,\n        position: 'absolute',\n        right: 10,\n        bottom: 30,\n        zIndex: 999,\n        height: 40,\n        width: 40,\n        borderRadius: 20,\n        backgroundColor: Color.white,\n        alignItems: 'center',\n        justifyContent: 'center',\n        shadowColor: Color.black,\n        shadowOpacity: 0.5,\n        shadowOffset: { width: 0, height: 0 },\n        shadowRadius: 1,\n    },\n});\nexport default class MessageContainer extends React.PureComponent {\n    constructor() {\n        super(...arguments);\n        this.state = {\n            showScrollBottom: false,\n            hasScrolled: false,\n        };\n        this.renderTypingIndicator = () => {\n            if (Platform.OS === 'web') {\n                return null;\n            }\n            return <TypingIndicator isTyping={this.props.isTyping || false}/>;\n        };\n        this.renderFooter = () => {\n            if (this.props.renderFooter) {\n                return this.props.renderFooter(this.props);\n            }\n            return this.renderTypingIndicator();\n        };\n        this.renderLoadEarlier = () => {\n            if (this.props.loadEarlier === true) {\n                const loadEarlierProps = {\n                    ...this.props,\n                };\n                if (this.props.renderLoadEarlier) {\n                    return this.props.renderLoadEarlier(loadEarlierProps);\n                }\n                return <LoadEarlier {...loadEarlierProps}/>;\n            }\n            return null;\n        };\n        this.scrollToBottom = (animated = true) => {\n            const { inverted } = this.props;\n            if (inverted) {\n                this.scrollTo({ offset: 0, animated });\n            }\n            else if (this.props.forwardRef && this.props.forwardRef.current) {\n                this.props.forwardRef.current.scrollToEnd({ animated });\n            }\n        };\n        this.handleOnScroll = (event) => {\n            const { nativeEvent: { contentOffset: { y: contentOffsetY }, contentSize: { height: contentSizeHeight }, layoutMeasurement: { height: layoutMeasurementHeight }, }, } = event;\n            const { scrollToBottomOffset } = this.props;\n            if (this.props.inverted) {\n                if (contentOffsetY > scrollToBottomOffset) {\n                    this.setState({ showScrollBottom: true, hasScrolled: true });\n                }\n                else {\n                    this.setState({ showScrollBottom: false, hasScrolled: true });\n                }\n            }\n            else {\n                if (contentOffsetY < scrollToBottomOffset &&\n                    contentSizeHeight - layoutMeasurementHeight > scrollToBottomOffset) {\n                    this.setState({ showScrollBottom: true, hasScrolled: true });\n                }\n                else {\n                    this.setState({ showScrollBottom: false, hasScrolled: true });\n                }\n            }\n        };\n        this.renderRow = ({ item, index }) => {\n            if (!item._id && item._id !== 0) {\n                warning('GiftedChat: `_id` is missing for message', JSON.stringify(item));\n            }\n            if (!item.user) {\n                if (!item.system) {\n                    warning('GiftedChat: `user` is missing for message', JSON.stringify(item));\n                }\n                item.user = { _id: 0 };\n            }\n            const { messages, user, inverted, ...restProps } = this.props;\n            if (messages && user) {\n                const previousMessage = (inverted ? messages[index + 1] : messages[index - 1]) || {};\n                const nextMessage = (inverted ? messages[index - 1] : messages[index + 1]) || {};\n                const messageProps = {\n                    ...restProps,\n                    user,\n                    key: item._id,\n                    currentMessage: item,\n                    previousMessage,\n                    inverted,\n                    nextMessage,\n                    position: item.user._id === user._id ? 'right' : 'left',\n                };\n                if (this.props.renderMessage) {\n                    return this.props.renderMessage(messageProps);\n                }\n                return <Message {...messageProps}/>;\n            }\n            return null;\n        };\n        this.renderChatEmpty = () => {\n            if (this.props.renderChatEmpty) {\n                return this.props.inverted ? (this.props.renderChatEmpty()) : (<View style={styles.emptyChatContainer}>\n          {this.props.renderChatEmpty()}\n        </View>);\n            }\n            return <View style={styles.container}/>;\n        };\n        this.renderHeaderWrapper = () => (<View style={styles.headerWrapper}>{this.renderLoadEarlier()}</View>);\n        this.onLayoutList = () => {\n            if (!this.props.inverted &&\n                !!this.props.messages &&\n                this.props.messages.length) {\n                setTimeout(() => this.scrollToBottom && this.scrollToBottom(false), 15 * this.props.messages.length);\n            }\n        };\n        this.onEndReached = ({ distanceFromEnd }) => {\n            const { loadEarlier, onLoadEarlier, infiniteScroll, isLoadingEarlier, } = this.props;\n            if (infiniteScroll &&\n                (this.state.hasScrolled || distanceFromEnd > 0) &&\n                distanceFromEnd <= 100 &&\n                loadEarlier &&\n                onLoadEarlier &&\n                !isLoadingEarlier &&\n                Platform.OS !== 'web') {\n                onLoadEarlier();\n            }\n        };\n        this.keyExtractor = (item) => `${item._id}`;\n    }\n    scrollTo(options) {\n        if (this.props.forwardRef && this.props.forwardRef.current && options) {\n            this.props.forwardRef.current.scrollToOffset(options);\n        }\n    }\n    renderScrollBottomComponent() {\n        const { scrollToBottomComponent } = this.props;\n        if (scrollToBottomComponent) {\n            return scrollToBottomComponent();\n        }\n        return <Text>V</Text>;\n    }\n    renderScrollToBottomWrapper() {\n        const propsStyle = this.props.scrollToBottomStyle || {};\n        return (<View style={[styles.scrollToBottomStyle, propsStyle]}>\n        <TouchableOpacity onPress={() => this.scrollToBottom()} hitSlop={{ top: 5, left: 5, right: 5, bottom: 5 }}>\n          {this.renderScrollBottomComponent()}\n        </TouchableOpacity>\n      </View>);\n    }\n    render() {\n        const { inverted } = this.props;\n        return (<View style={this.props.alignTop ? styles.containerAlignTop : styles.container}>\n        {this.state.showScrollBottom && this.props.scrollToBottom\n                ? this.renderScrollToBottomWrapper()\n                : null}\n        <FlatList ref={this.props.forwardRef} extraData={[this.props.extraData, this.props.isTyping]} keyExtractor={this.keyExtractor} enableEmptySections automaticallyAdjustContentInsets={false} inverted={inverted} data={this.props.messages} style={styles.listStyle} contentContainerStyle={styles.contentContainerStyle} renderItem={this.renderRow} {...this.props.invertibleScrollViewProps} ListEmptyComponent={this.renderChatEmpty} ListFooterComponent={inverted ? this.renderHeaderWrapper : this.renderFooter} ListHeaderComponent={inverted ? this.renderFooter : this.renderHeaderWrapper} onScroll={this.handleOnScroll} scrollEventThrottle={100} onLayout={this.onLayoutList} onEndReached={this.onEndReached} onEndReachedThreshold={0.1} {...this.props.listViewProps}/>\n      </View>);\n    }\n}\nMessageContainer.defaultProps = {\n    messages: [],\n    user: {},\n    isTyping: false,\n    renderChatEmpty: null,\n    renderFooter: null,\n    renderMessage: null,\n    onLoadEarlier: () => { },\n    onQuickReply: () => { },\n    inverted: true,\n    loadEarlier: false,\n    listViewProps: {},\n    invertibleScrollViewProps: {},\n    extraData: null,\n    scrollToBottom: false,\n    scrollToBottomOffset: 200,\n    alignTop: false,\n    scrollToBottomStyle: {},\n    infiniteScroll: false,\n    isLoadingEarlier: false,\n};\nMessageContainer.propTypes = {\n    messages: PropTypes.arrayOf(PropTypes.object),\n    isTyping: PropTypes.bool,\n    user: PropTypes.object,\n    renderChatEmpty: PropTypes.func,\n    renderFooter: PropTypes.func,\n    renderMessage: PropTypes.func,\n    renderLoadEarlier: PropTypes.func,\n    onLoadEarlier: PropTypes.func,\n    listViewProps: PropTypes.object,\n    inverted: PropTypes.bool,\n    loadEarlier: PropTypes.bool,\n    invertibleScrollViewProps: PropTypes.object,\n    extraData: PropTypes.object,\n    scrollToBottom: PropTypes.bool,\n    scrollToBottomOffset: PropTypes.number,\n    scrollToBottomComponent: PropTypes.func,\n    alignTop: PropTypes.bool,\n    scrollToBottomStyle: StylePropType,\n    infiniteScroll: PropTypes.bool,\n};\n//# sourceMappingURL=MessageContainer.js.map"]},"metadata":{},"sourceType":"module"}